<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UIC Assist</title>
  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.css" rel="stylesheet">

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="css/material-components.css">





  <style>
    .hidden {
      display: none;
    }

    body {
      margin: 0;
    }

    h1 {
      padding-top: 16px;
    }

    a.material-icons {
      text-decoration: none;
    }

    .screen {
      padding-left: 16px;
    }
  </style>
</head>

<body class="mdc-typography">

  <template id="MDCCard">
			<div class="mdc-card">
				<section class="mdc-card__media"><img src="http://chart.apis.google.com/chart?chs=300x225&cht=p&chd=t:32.787,50.82,100,42.623&chdl=the|big|party.jpg" alt="Mountain View"></section>
				<section class="mdc-card__primary">
					<h1 class="mdc-card__title mdc-card__title--large">Title goes here</h1>
					<h2 class="mdc-card__subtitle">Subtitle here</h2>
				</section>
				<section class="mdc-card__supporting-text">
				Lorem ipsum dolor sit amet, consectetur adipisicing elit. Molestias, dolore modi distinctio recusandae, laudantium nulla quidem odio maiores exercitationem odit doloremque laboriosam, cum quos obcaecati officiis repellat perspiciatis sequi omnis.
				</section>
				<section class="mdc-card__actions">
					<button class="mdc-button mdc-button--compact mdc-card__action" id="moreDetail" alt="put info here" onclick="showMoreDetail()">More Detail</button>
				</section>
			</div>
		</template>


  <header class="mdc-toolbar mdc-toolbar--fixed demo-toolbar">
    <div class="mdc-top-app-bar__row">
      <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
        <a href="#" class="material-icons mdc-top-app-bar__navigation-icon">menu</a>
        <span class="mdc-top-app-bar__title">UIC Assist</span>
      </section>
    </div>
  </header>


  <main>
    <div class="mdc-toolbar-fixed-adjust">
      <div class="">
        <div class="screen hidden" id="home">

          <h1>Visuilations for UIC Classes</h1>
          <p>Want to see how a class performed last semester? A Professors Grade distribution?</p>
          <p>Click Below to do search</p>
          <button class="mdc-button mdc-button--raised" id="doSearch">Do Search</button>

          <h1>What is this Visualization?</h1>
          <p>Using publically accessable data this website allows you to quickly and eaisly search through publically accesable data to get a better handle on courses and professors here at UIC.</p>
          <p>If you are intrested in where this data comes from or want to download the data yourself please visit the about page!</p>

          <h1>You Can Search By</h1>

          <ul>
            <li>Class</li>
            <li>Department</li>
          </ul>
          <button class="mdc-button mdc-button--raised" id="otherReq">View Other Requirements</button>

        </div>

        <div class="screen hidden" id="search">
          <div class="mdl-layout__tab-panel is-active" id="one" align="center">
            <!-- Simple Textfield -->
            <div id="searchField">
              <h4>Search by Class!</h4>
              <div class="mdc-text-field" data-mdc-auto-init="MDCTextField">
                <input type="text" id="className" class="mdc-text-field__input">
                <label for="className" class="mdc-floating-label">Class Name</label>
                <div class="mdc-line-ripple"></div>
              </div>
              <p class="mdc-text-field-helper-text" aria-hidden="false">
                Enter in format "CS 109" or simply use the Department Abrivation "CS" ect.
              </p>
              <button class="mdc-button mdc-button--raised" id="classSearch">
				  Search by Class
				</button>
            </div>
            <p>Please allow time for the data to be feached.</p>
            <hr>
            <div id="searchClassResultCards">

            </div>
          </div>
        </div>

        <div class="screen hidden" id="ShowingMoreDetail">

          <h1>Detailed Information</h1>
          <h2>Professors that have taught this course</h2>
          <ul id="prof_list"></ul>
          <div id="chart_div"></div>

          <button class="mdc-button mdc-button--raised" id="doSearch2">Back to Search!</button>
        </div>

        <div class="screen hidden" id="about">
          <h2>Grade Data</h2>

          <p>At the end of every semester The University of Illinois at Chicago publically releases grade distributions for all courses that have 10 or more students enrolled. This data set includes the number of students enrolled in the class and the number
            of people that have gotten each letter grade (A-F).</p>
          <p>This data can be accessed from <a href="http://www.oir.uic.edu/">The Office of Instutional Research</a>.</p>

          <hr>

        </div>

        <div class="screen hidden" id="other">
          <h1>Using Yahoo Weather API with Location Data</h1>
          <h2 id="addCity">Weather for </h2>
          <h3 id="addLatLon">You are at exactly </h3>
          <h3 id="addTime"></h3>
          <div id="addImg"></div>
          <p id="addCW">Current weather: </p>



        </div>

      </div>
    </div>
  </main>

  <aside class="mdc-drawer mdc-drawer--temporary mdc-typography" data-mdc-auto-init="MDCTemporaryDrawer">
    <nav class="mdc-drawer__drawer">
      <header class="mdc-drawer__header">
        <div class="mdc-drawer__header-content">
          UIC Assist
        </div>
      </header>
      <nav id="icon-with-text-demo" class="mdc-drawer__content mdc-list">
        <a class="mdc-list-item" href="#" data-screen="search">
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">home</i>Home
              </a>
        <a class="mdc-list-item" href="#" data-screen="search">
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">search</i>Search
              </a>
        <a class="mdc-list-item" href="#" data-screen="other">
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">stars</i>Other
              </a>
        <a class="mdc-list-item" href="#" data-screen="about">
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">info</i>About
              </a>
      </nav>
    </nav>
  </aside>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.js"></script>

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>



  <script>
    window.mdc.autoInit();

    function geo_success(position) {
      console.log(position.coords.latitude, position.coords.longitude);

      $.get("https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(SELECT%20woeid%20FROM%20geo.places%20WHERE%20text%3D%22(" + position.coords.latitude + "%2C" + position.coords.longitude + ")%22)&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys")
        .done(function(responce) {
          console.log(responce);
          console.log(responce.query.results.channel);
          var div = document.getElementById('addCity');
          div.innerHTML += responce.query.results.channel.location.city;

          var div = document.getElementById('addLatLon');
          div.innerHTML += responce.query.results.channel.item.lat + ", " + responce.query.results.channel.item.long;

          var div = document.getElementById('addTime');
          div.innerHTML += responce.query.results.channel.lastBuildDate;

          var div = document.getElementById('addCW');
          div.innerHTML += responce.query.results.channel.item.condition.text;


          //set image baised on forecast for day
          console.log(responce.query.results.channel.item.condition.code);
          var div = document.getElementById('addImg');

          var key = responce.query.results.channel.item.condition.code;

          switch (parseInt(key)) {
            case 0:
            case 1:
            case 2:
              div.innerHTML += '<img src="./images/fog.png" alt="Mountain View">';
              break;
            case 3:
            case 4:
            case 37:
            case 38:
            case 39:
              div.innerHTML += '<img src="./images/thunderstorm.png" alt="Mountain View">';
              break;
            case 5:
            case 6:
            case 7:
            case 8:
            case 9:
            case 10:
            case 11:
            case 12:
              div.innerHTML += '<img src="./images/rain.png" alt="Mountain View">';
              break;
            case 12:
            case 13:
            case 14:
            case 15:
            case 16:
            case 41:
            case 42:
            case 43:
            case 41:
            case 42:
            case 43:
            case 44:
            case 46:
              div.innerHTML += '<img src="./images/snow.png" alt="Mountain View">';
              break;
            case 17:
            case 18:
              div.innerHTML += '<img src="./images/hail.png" alt="Mountain View">';
              break;
            case 19:
            case 20:
            case 21:
            case 22:
            case 23:
            case 24:
            case 25:
            case 26:
            case 44:
              div.innerHTML += '<img src="../images/cloudy.png" alt="Mountain View">';
              break;
            case 27:
            case 28:
            case 29:
            case 30:
              div.innerHTML += '<img src="../images/partly-cloudy.png" alt="Mountain View">';
              break;
            case 31:
            case 33:
              div.innerHTML += '<img src="./images/clear-night.png" alt="Mountain View">';
              break;
            case 32:
            case 34:
            case 36:
              div.innerHTML += '<img src="./images/clear.png" alt="Mountain View">';
              break;
            case 35:
            case 40:
              div.innerHTML += '<img src="./images/cloudy-scattered-showers.png" alt="Mountain View">';
              break;
            default:
              console.log("def")
              break;
          }
        })

    }

    function geo_error() {
      alert("Sorry, no position available.");
    }

    var geo_options = {
      enableHighAccuracy: true,
      maximumAge: 30000,
      timeout: 27000
    };

    var wpid = navigator.geolocation.getCurrentPosition(geo_success, geo_error, geo_options);

    $("#doSearch").on("click", showsearch);
    $("#doSearch2").on("click", showsearch);
    $("#classSearch").on("click", searchByClass);
    $("#otherReq").on("click", showOther);

    function showsearch() {
      showScreen("search")
    }

    function showOther() {
      showScreen("other")
    }
    var GlobalObj;


    if ('serviceWorker' in navigator) {
      navigator.serviceWorker
        .register('./service-worker.js')
        .then(function() { console.log('Service Worker Registered'); });
    }

    function Class(name, a, b, c, d, f, total, ind, sem, nam, prof) {
      this.className = name;
      this.As = a;
      this.Bs = b;
      this.Cs = c;
      this.Ds = d;
      this.Fs = f;
      this.total = total;
      this.index = ind;
      this.semesters = sem;
      this.courseName = nam;
      this.professor = prof;
    }


    function searchByClass() {
      //get the search paramater
      var searchParam = $("#className").val();
      //split course name and number
      var split = searchParam.split(" ");
      var cName = split[0];
      var cNumber = split[1];

      var filter;
      //Test if name was entered
      if (cName != null) {
        var filter = "CRS_SUBJ_CD=" + cName.toUpperCase();
      }
      //Test if number is entered
      if (cNumber != null && cNumber != "") {
        filter = filter + "&CRS_NBR=" + cNumber;
      }
      //Check if the filter paramater is empty before doing the search
      if (filter != null) {
        var webAppUrl = 'https://script.google.com/macros/s/AKfycbxJmeT8MT2W5C5jPXII_OdLRgY1BDXk5APQ_iXWEVGMUrfdQvA4/exec?';

        var sheet = "Grades";

        var url = webAppUrl + "dataset=" + sheet + "&" + filter;

        var oo = new Object();

        $.ajax({
          type: 'GET',
          url: url,
          async: false,
          jsonpCallback: 'callback',
          //contentType: "application/json",
          dataType: 'jsonp',
          success: function(json) {

            $.each(json, function(i, entry) {

              //for each class create an object that can hold the paramater
              if (oo[entry.CRS_SUBJ_CD + entry.CRS_NBR] != null) {
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR]["As"] += entry.A;
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR]["Bs"] += entry.A;
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR]["Cs"] += entry.A;
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR]["Ds"] += entry.A;
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR]["Fs"] += entry.A;
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR]["total"] += entry.Grade_Regs;
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR]["index"] += 1;
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR]["semesters"] += ", " + entry.Term;
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR]["professor"] += "; " + entry.Primary_Instructor;

              }
              else {
                oo[entry.CRS_SUBJ_CD + entry.CRS_NBR] = new Class((entry.CRS_SUBJ_CD + " " + entry.CRS_NBR), entry.A, entry.B, entry.C, entry.D, entry.F, entry.Grade_Regs, 1, entry.Term, entry.CRS_TITLE, entry.Primary_Instructor);
              }

            });
            document.querySelector("#searchClassResultCards").innerHTML = "";
            for (var oneclass in oo) {
              var obj = oo[oneclass];
              var card = document.querySelector('#MDCCard');
              var element = card.content.querySelector(".mdc-card__title");
              element.textContent = obj["className"];
              var element = card.content.querySelector(".mdc-card__subtitle");
              element.textContent = obj["courseName"];
              var element = card.content.querySelector(".mdc-card__supporting-text");
              element.textContent = obj["courseName"] + " Has been taught for a total of " + obj["index"] + " semesters in this dataset (" + obj["semesters"] + ") to a total of " + obj["total"] + " students";

              var imglink = "http://chart.apis.google.com/chart?chs=300x225&cht=p&chd=t:" + obj["As"] / obj["total"] + "," +
                obj["Bs"] / obj["total"] + "," +
                obj["Cs"] / obj["total"] + "," +
                obj["Ds"] / obj["total"] + "," +
                obj["Fs"] / obj["total"] +
                "&chdl=A's|B's|C's|D's|F's";

              var element = card.content.querySelector("img");
              $(element).attr('src', imglink);

              var detail = obj["className"];

              var element = card.content.querySelector("button");
              $(element).attr('alt', detail);

              var element = card.content.querySelector("button");
              $(element).attr('onclick', "showMoreDetail(\"" + detail + "\")");


              var loc = document.querySelector("#searchClassResultCards");
              var clone = document.importNode(card.content, true);
              loc.appendChild(clone);



            }
            //Loop through all objects and create Cards

          },
          error: function(e) {
            console.log(e.message);
          }
        });
      }
    }



    let drawer = new mdc.drawer.MDCTemporaryDrawer(document.querySelector('.mdc-drawer--temporary'));

    document.querySelector('.mdc-top-app-bar__navigation-icon').addEventListener('click', () => drawer.open = true);

    var drawerLinks = document.querySelectorAll('.mdc-list-item');

    for (var i = 0; i < drawerLinks.length; i++) {

      drawerLinks[i].addEventListener('click', (e) => {

        var screen;
        var attributes = e.target.attributes;

        for (var i = 0; i < attributes.length; i++) {
          console.log(attributes[i].name, attributes[i].value);
          if (attributes[i].name == "data-screen") {
            screen = attributes[i].value;
          }
        }
        drawer.open = false;

        showScreen(screen)
      });
    }

    showScreen("home");

    function showScreen(id) {
      var screens = document.querySelectorAll(".screen");
      for (var i = 0; i < screens.length; i++) {
        screens[i].classList.add("hidden");
      }

      document.querySelector("#" + id).classList.remove("hidden");
    }

    function showMoreDetail(className) {
      var split = className.split(" ");
      var cName = split[0];
      var cNumber = split[1];

      var webAppUrl = 'https://script.google.com/macros/s/AKfycbxJmeT8MT2W5C5jPXII_OdLRgY1BDXk5APQ_iXWEVGMUrfdQvA4/exec?';
      var sheet = "Grades";
      var filter = "CRS_SUBJ_CD=" + cName + "&CRS_NBR=" + cNumber;

      var url = webAppUrl + "dataset=" + sheet + "&" + filter;

      var oo = new Object();

      $.ajax({
        type: 'GET',
        url: url,
        async: false,
        jsonpCallback: 'callback',
        //contentType: "application/json",
        dataType: 'jsonp',
        success: function(json) {
          showScreen("ShowingMoreDetail");

          $.each(json, function(i, entry) {

            //for each class create an object that can hold the paramater
            if (oo[entry.Primary_Instructor + " - " + entry.Term] != null) {
              oo[entry.Primary_Instructor + " - " + entry.Term]["As"] += entry.A;
              oo[entry.Primary_Instructor + " - " + entry.Term]["Bs"] += entry.A;
              oo[entry.Primary_Instructor + " - " + entry.Term]["Cs"] += entry.A;
              oo[entry.Primary_Instructor + " - " + entry.Term]["Ds"] += entry.A;
              oo[entry.Primary_Instructor + " - " + entry.Term]["Fs"] += entry.A;
              oo[entry.Primary_Instructor + " - " + entry.Term]["total"] += entry.Grade_Regs;
              oo[entry.Primary_Instructor + " - " + entry.Term]["index"] += 1;
              oo[entry.Primary_Instructor + " - " + entry.Term]["semesters"] += ", " + entry.Term;

            }
            else {
              oo[entry.Primary_Instructor + " - " + entry.Term] = new Class((entry.CRS_SUBJ_CD + " " + entry.CRS_NBR), entry.A, entry.B, entry.C, entry.D, entry.F, entry.Grade_Regs, 1, entry.Term, entry.CRS_TITLE, entry.Primary_Instructor);
            }

          });


          var first = true;
          for (var oneclass in oo) {
            if (first) {
              first = false;
              GlobalObj = oo[oneclass];
              //plot this instructor into a google chart.
              google.charts.load('current', { 'packages': ['corechart'] });

              google.charts.setOnLoadCallback(drawChart);
              console.log("here to draw");

              var div = document.getElementById('prof_list');
              div.innerHTML += '<li class="mdc-button mdc-button--compact mdc-card__action" onclick="resetGO(' + GlobalObj["As"] + "," +
                GlobalObj["Bs"] + "," +
                GlobalObj["Cs"] + "," +
                GlobalObj["Ds"] + "," +
                GlobalObj["Fs"] + ",\'" +
                GlobalObj["semesters"] + "\'," +
                ')">' + GlobalObj["professor"] + " " + GlobalObj["semesters"] + '</li>';
            }
            else {
              var temp = oo[oneclass];
              var div = document.getElementById('prof_list');
              div.innerHTML += '<li class="mdc-button mdc-button--compact mdc-card__action" onclick="resetGO(' + temp["As"] + "," +
                temp["Bs"] + "," +
                temp["Cs"] + "," +
                temp["Ds"] + "," +
                temp["Fs"] + ",\'" +
                temp["semesters"] + "\'," +
                ')">' + temp["professor"] + " " + temp["semesters"] + '</li>';
            }

            //for both set onclick to redraw google chart


          }

        },
        error: function(e) {
          console.log(e.message);
        }
      });
    }

    function resetGO(a, b, c, d, f, T) {
      console.log("Here to redraw")

      console.log(object);
      var object = new Class("n/a", a, b, c, d, f, 0, 1, T, "n/a", "n/a");
      document.querySelector("#chart_div").innerHTML = "";
      GlobalObj = object;

      google.charts.load('current', { 'packages': ['corechart'] });

      google.charts.setOnLoadCallback(drawChart);

    }


    // Set a callback to run when the Google Visualization API is loaded.
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      // Create the data table.
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Topping');
      data.addColumn('number', 'Slices');
      data.addRows([
        ['As', GlobalObj["As"]],
        ['Bs', GlobalObj["Bs"]],
        ['Cs', GlobalObj["Cs"]],
        ['Ds', GlobalObj["Ds"]],
        ['Fs', GlobalObj["Fs"]]
      ]);

      console.log(GlobalObj)
      // Set chart options
      var options = {
        'title': GlobalObj["semesters"],
        'width': 400,
        'height': 300
      };

      // Instantiate and draw our chart, passing in some options.
      var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }
  </script>



</body>

</html>
